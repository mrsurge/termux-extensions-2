<section class="tlm-app" data-role="termux-lm-root">
  <header class="tlm-header">
    <div>
      <h1>Termux-LM</h1>
      <p class="tlm-subtitle">Manage local llama.cpp instances and remote providers with persistent chat sessions.</p>
    </div>
    <div class="tlm-header-actions">
      <button class="tlm-btn ghost" data-action="refresh-models">Refresh</button>
      <button class="tlm-btn primary" data-action="add-model">Add Model</button>
    </div>
  </header>

  <section class="tlm-section tlm-shell-info">
    <div class="tlm-section-header">
      <div>
        <h2 class="tlm-section-title">Shell Status</h2>
        <p class="tlm-section-hint">Displays the current llama.cpp shell spawned by Termux-LM.</p>
      </div>
      <div class="tlm-shell-meta">
        <span id="tlm-active-model-label" data-role="active-model-label">No model loaded</span>
        <button class="tlm-btn ghost" data-action="refresh-log">Refresh Log</button>
      </div>
    </div>
    <div class="tlm-shell-logs">
      <article class="tlm-log-card">
        <header>STDOUT</header>
        <pre data-role="shell-stdout">(empty)</pre>
      </article>
      <article class="tlm-log-card">
        <header>STDERR</header>
        <pre data-role="shell-stderr">(empty)</pre>
      </article>
    </div>
    <button class="tlm-btn primary tlm-btn-wide" data-action="start-chat">Start Chat</button>
  </section>

  <section class="tlm-section tlm-models">
    <div class="tlm-section-header">
      <div>
        <h2 class="tlm-section-title">Models</h2>
        <p class="tlm-section-hint">Configure local llama.cpp models or remote APIs, then launch sessions.</p>
      </div>
    </div>
    <div class="tlm-card-grid" data-role="card-container">
      <div class="tlm-empty" data-role="empty-state">No models yet. Add one to get started.</div>
    </div>
  </section>

  <section class="tlm-section tlm-runmode" data-role="runmode">
    <div class="tlm-section-header">
      <div>
        <h2 class="tlm-section-title">Run Mode</h2>
        <p class="tlm-section-hint">Pick how the active model should run when a session starts.</p>
      </div>
    </div>
    <div class="tlm-runmode-options">
      <label class="tlm-radio">
        <input type="radio" name="run-mode" value="chat" checked>
        <span>Chat Interface</span>
      </label>
      <label class="tlm-radio">
        <input type="radio" name="run-mode" value="open_interpreter">
        <span>Open Interpreter (placeholder)</span>
      </label>
    </div>
  </section>

  <dialog class="tlm-modal" data-modal="model-form">
    <form method="dialog" class="tlm-modal-body" data-role="model-form">
      <header>
        <h3 data-role="modal-title">Add Model</h3>
        <button class="tlm-btn ghost" type="button" data-action="close-modal">Close</button>
      </header>
      <div class="tlm-modal-content">
        <div class="tlm-type-toggle">
          <button class="tlm-btn" type="button" data-model-type="local" data-active="true">Local llama.cpp</button>
          <button class="tlm-btn" type="button" data-model-type="remote">Remote API</button>
        </div>

        <section class="tlm-form-section" data-form-section="local">
          <label class="tlm-field">
            <span>Display Name</span>
            <input name="name" type="text" placeholder="Gemma 2 2B" autocomplete="off">
          </label>
          <label class="tlm-field">
            <span>Model File</span>
            <div class="tlm-field-row">
              <input name="path" type="text" placeholder="/data/data/.../model.gguf" autocomplete="off">
              <button class="tlm-btn ghost" type="button" data-action="browse-model">Browse</button>
            </div>
          </label>
          <div class="tlm-field-grid">
            <label class="tlm-field">
              <span>Context Window</span>
              <input name="context_window" type="number" min="512" step="256" value="4096">
            </label>
            <label class="tlm-field">
              <span>Threads</span>
              <input name="threads" type="number" min="1" step="1" placeholder="8">
            </label>
            <label class="tlm-field">
              <span>GPU Layers</span>
              <input name="gpu_layers" type="number" min="0" step="1" placeholder="0">
            </label>
            <label class="tlm-field">
              <span>Batch Size</span>
              <input name="batch_size" type="number" min="1" step="1" placeholder="256">
            </label>
          </div>
        </section>

        <section class="tlm-form-section" data-form-section="remote" hidden>
          <label class="tlm-field">
            <span>Provider Name</span>
            <input name="provider" type="text" placeholder="OpenRouter" autocomplete="off">
          </label>
          <label class="tlm-field">
            <span>API Key</span>
            <input name="api_key" type="text" placeholder="sk-..." autocomplete="off">
          </label>
          <label class="tlm-field">
            <span>API Base URL</span>
            <input name="endpoint" type="url" placeholder="https://" autocomplete="off">
          </label>
        </section>
      </div>
      <footer>
        <button class="tlm-btn ghost" type="button" data-action="close-modal">Cancel</button>
        <button class="tlm-btn primary" type="submit">Save</button>
      </footer>
    </form>
  </dialog>

  <div class="tlm-chat-overlay" data-shell hidden>
    <div class="tlm-chat-panel" data-shell-panel>
      <aside class="tlm-chat-drawer" data-shell-drawer>
        <header>
          <h3>Sessions</h3>
          <button class="tlm-btn ghost" type="button" data-action="close-drawer">Close</button>
        </header>
        <button class="tlm-btn primary tlm-btn-wide" type="button" data-action="new-session">New Session</button>
        <ul class="tlm-session-list" data-shell-sessions></ul>
      </aside>
      <div class="tlm-chat-main">
        <header class="tlm-chat-header">
          <button class="tlm-btn ghost" type="button" data-action="chat-back">Back</button>
          <div class="tlm-chat-heading">
            <h2 data-role="chat-title">Chat Session</h2>
            <span class="tlm-chat-mode" data-role="chat-mode">Chat Interface</span>
          </div>
          <button class="tlm-btn ghost tlm-chat-drawer-toggle" type="button" data-action="toggle-drawer">Sessions</button>
        </header>
        <div class="tlm-chat-log" data-role="chat-log"></div>
        <div class="tlm-chat-empty" data-role="chat-empty">No messages yet. Say hello.</div>
        <form class="tlm-chat-form" data-role="chat-form">
          <textarea data-role="chat-input" rows="2" placeholder="Send a message..." autocomplete="off"></textarea>
          <div class="tlm-chat-actions">
            <span class="tlm-token-readout" data-role="token-readout"></span>
            <button class="tlm-btn primary" type="submit" data-role="chat-send">Send</button>
          </div>
        </form>
        <div class="tlm-chat-placeholder" data-role="oi-placeholder" hidden>
          <p>Open Interpreter mode is a placeholder for now. Switch back when ready.</p>
        </div>
      </div>
    </div>
    <div class="tlm-chat-overlay-bg" data-shell-overlay></div>
  </div>
</section>
